<!DOCTYPE html>
<html>

<head>
  <title>Data Visualization using D3!</title>
  <script src="/static/js/d3.min.js"></script>
</head>

<body>
  <svg  id="mainsvg" class="svgs"></svg>
  <script>

    //values里面保存的就是网格数据
    // var n = 256, m = 256, values = new Array(n * m);
    // for (var j = 0.5, k = 0; j < m; ++j) {
    //   for (var i = 0.5; i < n; ++i, ++k) {
    //     values[k] = goldsteinPrice(i / n * 4 - 2, 1 - j / m * 3);
    //   }
    // }
    
    value = (x, y) => Math.sin(x + y) * Math.sin(x - y);
    //value=[[0.02895747870206833, 0.028396762907505035, 0.023390956223011017, 0.020467817783355713, 0.018402986228466034, 0.019546277821063995, 0.02012442797422409, 0.015953324735164642, 0.018611527979373932, 0.01535814255475998, 0.016181983053684235], [0.029359139502048492, 0.034027524292469025, 0.03465113788843155, 0.03392801433801651, 0.04149331897497177, 0.043088965117931366, 0.04846786707639694, 0.025440029799938202, 0.019065089523792267, 0.017447583377361298, 0.011796504259109497], [0.04063018411397934, 0.04225144535303116, 0.051827333867549896, 0.05732760578393936, 0.05514482408761978, 0.055412374436855316, 0.0646013543009758, 0.051428891718387604, 0.04250102490186691, 0.029865272343158722, 0.017480842769145966], [0.05670318752527237, 0.06121774762868881, 0.0721505656838417, 0.08648817986249924, 0.08569478243589401, 0.08415881544351578, 0.08537036925554276, 0.06777065247297287, 0.06188628822565079, 0.05263843387365341, 0.04093904048204422], [0.08244501799345016, 0.09133198112249374, 0.09440029412508011, 0.10158472508192062, 0.10135043412446976, 0.10114457458257675, 0.1024206355214119, 0.08803380280733109, 0.07966544479131699, 0.07810104638338089, 0.07172047346830368], [0.08526790887117386, 0.08901629596948624, 0.09654311090707779, 0.09937994927167892, 0.09926380962133408, 0.10552623122930527, 0.106119804084301, 0.09069844335317612, 0.08298253268003464, 0.07783631235361099, 0.06397492438554764], [0.09293098002672195, 0.08598003536462784, 0.08045052736997604, 0.0842670425772667, 0.08902514725923538, 0.09957186132669449, 0.09900792688131332, 0.09109259396791458, 0.07963111251592636, 0.0676950141787529, 0.055259086191654205], [0.06548178941011429, 0.07303784042596817, 0.07459660619497299, 0.07462463527917862, 0.07982449978590012, 0.0794728621840477, 0.07670053094625473, 0.07032196968793869, 0.06420613080263138, 0.052534766495227814, 0.041571103036403656], [0.04423172026872635, 0.050640322268009186, 0.06360571831464767, 0.0747688040137291, 0.07742217928171158, 0.07086498290300369, 0.07145734876394272, 0.07302496582269669, 0.0732332393527031, 0.07231605798006058, 0.06929897516965866], [0.021171562373638153, 0.02857043594121933, 0.037800051271915436, 0.053824372589588165, 0.06803659349679947, 0.07459378987550735, 0.07580292969942093, 0.0731431171298027, 0.07299572974443436, 0.0763055756688118, 0.07480085641145706], [0.012902580201625824, 0.015148662030696869, 0.017823494970798492, 0.02235790342092514, 0.03108205646276474, 0.04150740057229996, 0.05128512531518936, 0.05689791589975357, 0.05722232908010483, 0.05317433923482895, 0.04756154865026474]]
    var q=6,scale=1/80,height=1800,width=1800;
    const x0 = -q / 2, x1 = width + q;
    const y0 = -q / 2, y1 = height + q;
    const n = Math.ceil((x1 - x0) / q);
    const m = Math.ceil((y1 - y0) / q);
    const grid = new Array(n * m);
    for (let j = 0; j < m; ++j) {
      for (let i = 0; i < n; ++i) {
        grid[j * n + i] = value(i * q * scale, j * q * scale);
      }
    }
    grid.n = n;
    grid.m = m;
    thresholds = Array.from({length: 4}, (_, i) => (i - 6) / 5)

    function callback(data){
      console.log(data);
    }
    d3.json('/api/v1.0/tasks',callback);

    //Compute the contour polygons at log-spaced
    //intervals; returns an array of MultiPolygon.

    var contours = d3.contours()
      .size([n, m])
      .thresholds(thresholds)
      (grid);

    var path = d3.geoPath();

    //color = d3.scaleSequential([-1, 1], d3.interpolateSpectral)
    var color=["#FF0000","#FF5151","#02F78E",
  "#FF9224"]
    var mainGroup = d3.select("#mainsvg");
    mainGroup.
      selectAll("path")
      .data(contours)
      .enter()
      .append("path")
      .attr("d", path)
      .attr('fill', (d,i)=>color[i]);

  </script>
</body>

</html>